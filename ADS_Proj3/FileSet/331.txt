that, when executed, makes the desired changes in the Registry. {| style="font-size:90%; margin:1.5em 1em 1.5em 2em;" |- | <source lang="reg"> Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\policies\Explorer] "NoDriveTypeAutoRun"=dword:000000ff </source> :''Note that the actual file should always end with a blank line. This is not optional.<ref name=kb310516/>'' |} In the above example, AutoRun would be disabled for all drives and for all users. This example would need to be run as Administrator and a reboot would be needed for the setting to take complete effect. === Initialization file mapping === Windows Vista and later versions of Windows have a policy setting, "Default behavior for AutoRun", that can be set to disallow the reading of an autorun.inf file on any volume. This avoids certain scenarios where [[malware]] leverages autorun.inf functionality to infect a machine. Previous versions of Windows do not have this policy setting but the use of [[INI file#File mapping|initialisation file mapping]] is an effective workaround.<ref>[http://nick.brown.free.fr/blog/2007/10/memory-stick-worms.html Memory stick worms], ''Nick Brown's blog''</ref> As an autorun.inf file is a standard Windows [[INI file]], the appropriate [[API]] calls are used by Windows when fetching its settings. These API calls can be redirected using the INI file mapping method. The following [[#Registry files|Registry file]] illustrates the workaround, where all autorun.inf settings are taken solely from the <tt>HKEY_LOCAL_MACHINE\Software\DoesNotExist</tt> Registry key: {| style="font-size:90%; margin:1.5em 1em 1.5em 2em;" |- | <source lang="reg"> Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\Autorun.inf] @="@SYS:DoesNotExist" </source> |} As this key does not exist, it is as if the autorun.inf file contains no settings information. It is important to note that this applies to any autorun.inf in any location and on any drive. Both the policy setting and this workaround have the drawback is that installation of software from an autorunning install CD or DVD is no longer automatic. It will be necessary to view the CD's autorun.inf file and then execute the appropriate install program manually. == Issues and security == === The AutoRun disable bug === From Windows 2000 through to Windows 2008 Server, AutoRun-relevant Registry entries were not handled properly leading to a security vulnerability.<ref>[http://www.kb.cert.org/vuls/id/889747 Windows Vista fails to properly handle the NoDriveTypeAutoRun registry value], [[US-CERT]]</ref> Windows 95 and Windows 98 were not affected. When AutoRun is disabled, Windows should not proceed further through the [[#AutoRun activation|activation]] sequence than the Registry check. However, it parses any autorun.inf found and does everything except the final action to invoke AutoPlay or execute an application. This leaves the user open to attack from malware which uses the autorun.inf to alter the double-click and contextual menu behaviours. Double clicking the drive icon will infect the machine. Right Clicking and selecting the "Explore" or "Open" options from the context menu is not a workaround as these menu items can be coopted by the appropriate autorun.inf entries. This bug was fixed in a number of security updates, detailed in [[Microsoft Knowledge Base]] article <tt>967715</tt>.<ref name=kb967715/> === Other issues === <ul> <li> If you add the computer to an Active Directory domain, the <tt>NoDriveTypeAutoRun</tt> value may be reset to a default value.<ref>[http://support.microsoft.com/kb/895108 The NoDriveTypeAutoRun subkey value is reset...], Microsoft, ''Knowledge Base''</ref> This is due to Group Policy settings in the domain taking effect. This is not a bug. </li> <li> Some programs may deliberately change AutoRun Registry settings. Early versions of CD burning software like Roxio have been known to change settings in this way.<ref name=kb330135>[http://support.microsoft.com/kb/330135 The AutoRun feature or the AutoPlay feature does not work...], Microsoft, ''Knowledge Base''</ref> </li> <li> If the Group Policy "Restrict CD-ROM access to locally logged-on user only" security option under: : Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options is turned on (Enabled), then AutoRun may not function.<ref name=kb330135/> Windows Installers will also malfunction because "Local System" access to the CD-ROM will be denied.<ref>[http://support.microsoft.com/kb/230895 You receive an "Installation ended prematurely because..."], Microsoft, ''Knowledge Base''</ref> This Group Policy setting reflects the value of the Registry entry: {| class="wikitable" style="margin:1.5em 1em 1.5em 2em;" |- | colspan="4" | <tt>HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon</tt> |- ! Entry name !! Data type !! Range !! Default |- | <tt>allocatecdroms</tt> | <center> REG_SZ </center> | <center> 0 or 1 </center> | <center> 0 </center> |} and should be set to 0. </li> <li> Real Player 10 interferes with AutoPlay functionality to the extent that it may look as if AutoRun or AutoPlay is not working at all.<ref>[http://gladiator-antivirus.com/forum/index.php?s=&showtopic=15090&view=findpost&p=54229 Camera and Scanner Wizard, stopped working], ''Gladiator Security chat forum''</ref><ref>[http://www.vista-xp.co.uk/forums/hardware-operating-problems/3469-autoplay-not-working-digital-camera-sorted.html#post30012 Autoplay not working with digital camera], ''vista-xp chat forum''</ref><ref>[http://www.tech-archive.net/Archive/WinXP/microsoft.public.windowsxp.photos/2005-01/0365.html How to repair your camera Autoplay download], ''tech-archive.net chat forum''</ref> </li> </ul> === Attack vectors === AutoRun functionality has been used as a malware vector for some time. Prior to Windows Vista, the default action with a CD-ROM drive type was to follow any autorun.inf file instructions without prompts or warnings. This makes rogue CD-ROMs one possible infection vector. In the same category are mixed content CD-ROMs. An audio CD, that a user would not expect to contain software at all, can contain a data section with an autorun.inf. Some companies, such as [[2005 Sony BMG CD copy protection scandal|Sony BMG]], have used this vector to install software that attempts to protect against copying of the audio tracks. [[U3]] enabled flash drives, by [[Emulator|emulating]] a CD-ROM unit, can also cause Windows to execute commands from the autorun.inf found on the emulated CD-ROM. Devices like the [[Huawei E220]] HSDPA modem, validly use this method to autoinstall drivers for the modem itself. However plugging in a flash drive from an unknown source is an unwise move. [http://wiki.hak5.org/wiki/USB_Switchblade USB Switchblade], and other similar tools, have made U3 flash drive attacks trivial. Given the ease of writing [[scripting language|script]] based attacks, [[anti-virus]] software may be ineffective in preventing data and password stealing. [[Image:Conficker worm AutoPlay Vista.png|thumb|Social Engineering: The [[Conficker]] worm [http://isc.sans.org/diary.html?storyid=5695 in action] ]] With a standard flash drive, social engineering attacks can be employed to entice a user to click on the appropriate item in the AutoPlay dialog. An alluring [[autorun.inf#%5bautorun%5d|action]] string promising free games or pornography would lure many users into the trap. At any time, double clicking on 