of ''N''. (Of course, a point ''P'' and the curve itself, ''E'', must also be found.) ECPP uses complex multiplication to construct the curve ''E'', doing so in a way that allows for ''m'' (the number of points on ''E'') to be easily computed. We will now describe this method: Utilization of complex multiplication requires a negative [[discriminant]], ''D'', such that ''D'' can be written as the product of two elements <math>D = \pi \bar{\pi}</math>, or completely equivalently, we can write the equation: : <math>a^2 + |D|b^2 = 4N \, </math> For some ''a, b''. If we can describe ''N'' in terms of either of these forms, we can create an elliptic curve ''E'' on <math>\mathbb{Z}/N\mathbb{Z}</math> with complex multiplication (described in detail below), and the number of points is given by: : <math>|E(\mathbb{Z}/N\mathbb{Z})| = N + 1 - \pi - \bar{\pi} = N + 1 - a. \, </math> For ''N'' to split into two the two elements, we need that <math>\left(\frac{D}{N}\right) = 1</math> (where <math>\left(\frac{D}{N}\right)</math> denotes the [[Legendre symbol]]). This is a necessary condition, and we achieve sufficiency if the [[Ideal class group|class number]] ''h''(''D'') of the order in <math>\mathbb{Q}(\sqrt{D})</math> is 1. This happens for only 13 values of ''D'', which are the elements of {&minus;3 , &minus;4 , &minus;7 , &minus;8 , &minus;11 , &minus;12 , &minus;16 , &minus;19 , &minus;27 , &minus;28 , &minus;43, &minus;67 , &minus;163} ==The test== Pick discriminants ''D'' in sequence of increasing ''h(D)''. For each ''D'' check if <math>\left(\frac{D}{N}\right) = 1</math> and whether ''4N'' can be written as: : <math>a^2 + |D|b^2 = 4N \, </math> This part can be verified using [[Cornacchia's algorithm]]. Once acceptable ''D'' and ''a'' have been discovered, calculate <math>m = N + 1 - a</math>. Now if ''m'' has a prime factor ''q'' of size : <math>q>(N^{1/4}+1)^2</math> use the complex multplication method to construct the curve ''E'' and a point ''P'' on it. Then we can use our proposition to verify the primality of ''N''. Note that if ''m'' does not have a large prime factor or cannot be factored quickly enough, another choice of ''D'' can be made.<ref name="HEHCC"/> ==Complex multiplication method== For completeness, we will provide an overview of [[complex multiplication]], the way in which an elliptic curve can be created, given our ''D'' (which can be written as a product of two elements). Assume first that <math>D \neq -3</math> and <math>D \neq -4</math> (these cases are much more easily done). It is necessary to calculate the elliptic [[j-invariant]]s of the ''h''(''D'') classes of the order of discriminant ''D'' as complex numbers. There are several formulas to calculate these. Next create the monic polynomial <math>H_D(X)</math>, which has roots corresponding to the ''h''(''D'') values. Note, that <math>H_D(X)</math> is the [[class polynomial]]. From complex multiplication theory, we know that <math>H_D(X)</math> has integer coefficients, which allows us to estimate these coefficients accurately enough to discover their true values. Now, if ''N'' is prime, CM tells us that <math>H_D(X)</math> splits modulo ''N'' into a product of ''h''(''D'') linear factors, based on the fact that ''D'' was chosen so that ''N'' splits as the product of two elements. Now if ''j'' is one of the ''h''(''D'') roots ''modulo N'' we can define ''E'' as: : <math>y^2 = x^3 - 3kc^{2r}x + 2kc^{3r},\text{ where } k = \frac{j}{j-1728},</math> ''c'' is any [[quadratic nonresidue]] mod ''N'', and ''r'' is either 0 or 1. Given a root ''j'' there are only two possible nonisomorphic choices of ''E'', one for each choice of ''r''. We have the cardinality of these curves as <math>|E(\mathbb{Z}/N\mathbb{Z})| = N+1-a</math> or <math>|E(\mathbb{Z}/N\mathbb{Z})| = N+1+a</math><ref name="HEHCC"/><ref name="BSS"/><ref>http://algo.inria.fr/seminars/sem97-98/morain.html</ref> ===Discussion=== Just as with the Goldwasser–Killian test, this one leads to a down-run procedure. Again, the culprit is ''q''. Once we find a ''q'' that works, we must check it to be prime, so in fact we are doing the whole test now for ''q''. Then again we may have to perform the test for factors of ''q''. This leads to a nested certificate where at each level we have an elliptic curve ''E'', an ''m'' and the prime in doubt, ''q''. ==Example of Atkin–Morain ECPP== We construct an example to prove that <math>N = 167</math> is prime using the Atkin–Morain ECPP test. First proceed through the set of 13 possible discriminants, testing whether the Legendre Symbol <math>(D/N) = 1</math>, and if 4''N'' can be written as <math> 4N = a^2 + |D|b^2</math>. For our example ''D'' = &minus;43 is chosen. This is because <math>(D/N) = (-43/167) = 1</math> and also, using Cornacchia's algorithm, we know that <math>4\cdot (167) = 25^2 + (43)(1^2)</math> and thus ''a'' = 25 and ''b'' = 1. The next step is to calculate ''m''. This is easily done as <math>m = N + 1 - a</math> which yields <math> m = 167 + 1 - 25 = 143</math>. Next we need to find a probable prime divisor of ''m'', which was referred to as ''q''. It must satisfy the condition that <math>q>(N^{1/4}+1)^2</math> Now in this case, ''m'' = 143 = 11*13. So unfortunately we cannot choose 11 or 13 as our ''q'', for it does not satisfy the necessary inequality. We are saved, however, by an analogous proposition to that which we stated before the Goldwasser–Kilian algorithm, which comes from a paper by Morain.<ref name="morain">Morain, Francois, Implementation of the Atkin–Goldwasser–Kilian Primality Testing Algorithm, https://eprints.kfupm.edu.sa/44864/1/44864.pdf</ref> It states, that given our ''m'', we look for an ''s'' which divides ''m'', <math>s>(N^{1/4}+1)^2</math>, but is not necessarily prime, and check whether, for each <math>p_i</math> which divides ''s'' : <math>m/p_iP \neq P_\infty</math> for some point ''P'' on our yet to be constructed curve. If ''s'' satisfies the inequality, and its prime factors satisfy the above, then ''N'' is prime. So in our case, we choose ''s'' = ''m'' = 143. Thus our possible <math>p_i</math>'s are 11 and 13. First, it is clear that <math>143 >(167^{1/4}+1)^2</math>, and so we need only check the values of : <math>(143/11)P = 13P \text{ and }(143/13)P = 11P.</math> But before we can do this, we must construct our curve, 