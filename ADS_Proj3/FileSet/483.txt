or standard rule to be selected.'' ====Decision factors at the Loc-RIB level==== Once candidate routes are received from neighbors, the Loc-RIB software applies additional tie-breakers to routes to the same destination. # If at least one route was learned from an external neighbor (i.e., the route was learned from EBGP), drop all routes learned from IBGP. # Prefer the route with the lowest interior cost to the NEXT_HOP, according to the main [[Routing Table]]. If two neighbors advertised the same route, but one neighbor is reachable via a low-bitrate link and the other by a high-bitrate link, and the interior routing protocol calculates lowest cost based on highest bitrate, the route through the high-bitrate link would be preferred and other routes dropped. ''If there is more than one route still tied at this point, several BGP implementations offer a configurable option to load-share among the routes, accepting all (or all up to some number).'' # Prefer the route learned from the BGP speaker with the numerically lowest BGP identifier # Prefer the route learned from the BGP speaker with the lowest peer IP address ===Communities=== BGP communities are attribute tags that can be applied to incoming or outgoing prefixes to achieve some common goal (RFC 1997). While it is common to say that BGP allows an administrator to set policies on how prefixes are handled by ISPs, this is generally not possible, strictly speaking. For instance, BGP natively has no concept to allow one AS to tell another AS to restrict advertisement of a prefix to only North American peering customers. Instead, an ISP generally publishes a list of well-known or proprietary communities with a description for each one, which essentially becomes an agreement of how prefixes are to be treated. Examples of common communities include local preference adjustments, geographic or peer type restrictions, DoS avoidance (black holing), and AS prepending options. An ISP might state that any routes received from customers with community XXX:500 will be advertised to all peers (default) while community XXX:501 will restrict advertisement to North America. The customer simply adjusts their configuration to include the correct community(ies) for each route, and the ISP is responsible for controlling who the prefix is advertised to. The end user has no technical ability to enforce correct actions being taken by the ISP, though problems in this area are generally rare and accidental. It is a common tactic for end customers to use BGP communities (usually ASN:70,80,90,100) to control the local preference the ISP assigns to advertised routes instead of using MED (the effect is similar). It should also be noted that the community attribute is transitive, but communities applied by the customer very rarely become propagated outside the next-hop AS. ===Extended communities=== The BGP Extended Community Attribute was added in 2006 in order to extend the range of such attributes and to provide a community attribute structuring by means of a type field. The extended format consists of one or two octets for the type field followed by seven or six octets for the respective community attribute content. The definition of this Extended Community Attribute is documented in RFC 4360. The IANA administers the registry for BGP Extended Communities Types.<ref>[http://www.iana.org/assignments/bgp-extended-communities IANA registry for BGP Extended Communities Types], IANA,2008</ref> The Extended Communities Attribute itself is a transitive optional BGP attribute. However, a bit in the type field within the attribute decides whether the encoded extended community is of a transitive or non-transitive nature. The IANA registry therefore provides different number ranges for the attribute types. Due to the extended attribute range, its usage can be manifold. RFC 4360 exemplarly defines the "Two-Octet AS Specific Extended Community", the "IPv4 Address Specific Extended Community", the "Opaque Extended Community", the "Route Target Community" and the "Route Origin Community". A number of BGP QoS drafts<ref>[http://www.bgp-qos.org/forum/viewforum.php?f=6 IETF drafts on BGP signalled QoS], Thomas Knoll,2008</ref> also use this Extended Community Attribute structure for inter-domain QoS signalling. ===Uses of multi-exit discriminators=== MEDs, defined in the main BGP standard, were originally intended to show to another neighbor AS the advertising AS's preference as to which of several links are preferred for inbound traffic. Another application of MEDs is to advertise the value, typically based on delay, of multiple AS that have presence at an [[IXP]], that they impose to send traffic to some destination. ==BGP problems and mitigation==<!-- This section is linked from [[Route flapping]] --> ===Internal BGP scalability=== An autonomous system with internal BGP (IBGP) must have all of its IBGP peers connect to each other in a [[Complete graph|full mesh]] (where everyone speaks to everyone directly). This full-mesh configuration requires that each router maintain a session to every other router. In large networks, this number of sessions may degrade performance of routers, due either to a lack of memory, or too much CPU process requirements. Route reflectors and confederations both reduce the number of IBGP peers to each router and thus reduce processing overhead. Route reflectors are a pure performance-enhancing technique, while confederations also can be used to implement more fine-grained policy. [[Route reflector]]s<ref>[http://www.ietf.org/rfc/rfc4456.txt BGP Route Reflection: An Alternative to Full Mesh Internal BGP (IBGP)], RFC 4456, T. Bates ''et al.'', April 2006</ref> reduce the number of connections required in an AS. A single router (or two for redundancy) can be made a route reflector: other routers in the AS need only be configured as peers to them. [[BGP_confederation|Confederations]] are sets of autonomous systems. In common practice,<ref>[http://www.ietf.org/rfc/rfc5065.txt Autonomous System Confederations for BGP], RFC 5065, P. Traina ''et al.'', February 2001</ref> only one of the confederation AS numbers is seen by the Internet as a whole. Confederations are used in very large networks where a large AS can be configured to encompass smaller more manageable internal ASs. Confederations can be used in conjunction with route reflectors. Both confederations and route reflectors can be subject to persistent oscillation unless specific design rules, affecting both BGP and the interior routing protocol, are followed.<ref>[http://www.ietf.org/rfc/rfc3345.txt Border Gateway Protocol (BGP) Persistent Route Oscillation Condition], RFC 3345, D. McPherson ''et al.'', August 