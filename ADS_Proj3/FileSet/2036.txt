not set and one of those occurs without the other, chaining is not allowed. The most common situations that suppress chaining are unit-exception and unit-check. In addition to the interrupt sent to the CPU when an I/O operation is complete, a channel can also send a Program-Controlled interrupt (PCI) to the CPU while the channel program is running, without terminating the operation, and a delayed device-end interrupt after the I/O completion interrupt. ====Channel status==== These conditions are detected by the channel and indicated in the [[#Channel Status Word|CSW]].<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=116-118}} =====Program-controlled interruption===== [[#CSW_Program-controlled_interruption|Program-controlled interruption]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=116-117}} indicates that the channel has encountered a CCW with the PCI bit set. The channel continues processing; this interrupt simply informs the CPU of the channel's progress. Program-controlled interruption could be used for rotational position sensing, as follows: imagine that the channel program consists of an endless loop of CCWs which seek the next sector of the drum and do nothing. The do nothing CCW has the PCI bit set, so the CPU is always aware of the last sector header read. When the operating system needs to allocate a page on the drum, it can allocate the page just after the current position, and modify the do nothing CCW to write that page, changing the CCW back to doing nothing on the next PCI interrupt. Using this technique saves rotation time on the drum, thereby improving throughput. =====Incorrect length===== [[#CSW_Incorrect_length|Incorrect length]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=117}} indicates that the data transfer for a command completed before the Count was exhausted. This indication is suppressed if the [[#CCW-SuppressLengthIndication|Suppress-Length-Indication]] bit in the CCW is set. =====Program check===== [[#CSW_Program_check|Program check]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=117}} indicates one of the following errors *Nonzero bits where zeros are required *An invalid data or CCW address *The CAW or a TIC refers to a TIC =====Protection check===== [[#CSW_Protection_check|Protection check]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=117-118}} indicates that the protection key in the CAW is non-zero and does not match the storage protection key. =====Channel data check===== [[#CSW_Channel_data_check|Channel data check]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=118}} indicates a parity error during a data transfer. =====Channel control check===== [[#CSW_Channel_control_check|Channel control check]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=118}} indicates a channel malfunction other than [[#Channel data check|Channel data check]] or [[#Interface control check|Interface control check]]. =====Interface control check===== [[#CSW_Interface_control_check|Interface control check]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=118}} indicates an invalid signal in the channel to control unit interface. =====Chaining check===== [[#CSW_Chaining_check|Chaining check]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=118}} indicates lost data during data chaining. ====Unit status==== These conditions are presented to the channel by the control unit or device.<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=113-116}} In some cases they are handled by the channel and in other cases they are indicated in the [[#Channel Status Word|CSW]]. There is no distinction between conditions detected by the control unit and conditions detected by the device. =====Attention===== [[#CSW_Attention|Attention]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=113}} indicates an unusual condition not associated with an ongoing channel program. It often indicates some sort of operator action like requesting input, in which case the CPU would respond by issuing a read command. =====Status modifier===== [[#CSW_Status_modifier|Status modifier]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=113-114}} (SM) indicates one of three unusual conditions *A Test I/O instruction was issued to a device that does not support it. *A [[#Busy|Busy]] status refers to the control unit rather than to the device. *A device has detected a condition that requires skipping a CCW. A CCW with a command for which Status Modifer is possible will normally specify command chaining, in which case the SM is processed by the channel and does not cause an interrupt. A typical channel program where SM occurs is ... Search Id Equal TIC *-8 Read Data where the TIC causes the channel to refetch the search until the device indicates a successful search by raising SM. =====Control unit end===== [[#CSW_Control_unit_end|Control unit end]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=114}} indicates that a previous control unit busy status has been cleared. =====Busy===== [[#CSW_Busy|Busy]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=114-115}} indicates that a device ([[Status modifier|SM]]=0) or a control unit ([[Status modifier|SM]]=1) is busy. =====Channel end===== [[#CSW_Channel_end>|Channel end]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=115}} indicates that the device has completed the data transfer for a channel command. There may also be an [[#Incorrect length|Incorrect length]] indication if the Count field of the CCW is exhausted, depending on the value of the [[#CCW-SuppressLengthIndication|Suppress-Length-Indication]] bit. =====Device end===== [[#CSW_Device_end|Device end]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=115}} indicates that the device has completed an operation and is ready to accept another. DE may be signalled concurrently with [[#Channel en|CE]] or may be delayed. =====Unit check===== [[#CSW_Unit_check|Unit check]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=115-116}} indicates that the device or control unit has detected an unusual conditions and that details may be obrained by issuing a Sense command. =====Unit exception===== [[#CSW_Unit_exception|Unit exception]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=116}} indicates that the device has detected an unusual condition, e.g., end of file. ====Channel Address Word==== The fullword ''Channel Address Word''<ref name=A22-6821-7/>{{rp|page=99}} (CAW) contains a 4-bit storage protection key and a 24-bit address of the channel program to be started. ====Channel Command Word==== A ''Channel Command Word'' is a doubleword containing the following *An 8-bit channel [[#CCW Command codes|Command Code]]<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=100}} *A 24-bit address<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=100-101}} *A 5-bit flag field<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=99-100,101-105}} *An unsigned halfword Count field<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=100-101}} =====CCW Command codes===== The low order 2 or 4 bits determine the six commands that the channel recognizes<ref name=A22-6821-7/>{{rp|pages=100,105}}; the high order bits sent to the control unit and device are known as modifier bits and their use is determined by the control unit and device. The encoding is {| class="wikitable collapsible" |+ CCW Command codes |- ! style="font-family:monospace; width:7em" | bits ! Command |- | style="font-family:monospace" | **** 0000 | Invalid |- | style="font-family:monospace" | MMMM 0100 | Sense<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=106-107}} |- | style="font-family:monospace" | **** 1000 | Transfer in Channel (TIC)<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=107-108}} |- | style="font-family:monospace" | MMMM 1100 | Read Backward<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=105-106}} |- | style="font-family:monospace" | MMMM MM01 | Write<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=105}} |- | style="font-family:monospace" | MMMM MM10 | Read<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|page=105}} |- | style="font-family:monospace" | MMMM MM11 | Control<sup class=reference>[[#PoOps|PoOps]]</sup>{{rp|pages=106-107}} |} Control is used to cause a state change in a device or control unit, often associated with mechanical motion, e.g., rewind, seek. Sense is used to read data describing the status of the device. The most important case is that when a command terminates with unit check, the specific cause can only be determined 